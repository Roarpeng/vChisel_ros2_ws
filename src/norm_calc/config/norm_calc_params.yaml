norm_calc:
  ros__parameters:
    # ==================== 区域与网格 ====================
    BOX_LEN: 0.05
    BOX_ROW: 4
    BOX_COLUMN: 6
    # 工作空间
    XMIN: -0.15
    XMAX: 0.15
    YMIN: -0.1
    YMAX: 0.1
    ZMIN: 0.2
    ZMAX: 0.8
    BORDER_WIDTH: 0.03
    
    # ==================== 预处理 ====================
    SEARCH_RADIUS: 0.015       # 法向估计半径
    SEARCH_NUM_TH: 30          # 离群点去除阈值
    
    # ==================== 核心策略参数 ====================
    # 严格模式 (第一次尝试：只打完美的点)
    STRICT_NORM_TH: 0.90       # cos(16度)，要求非常垂直
    STRICT_HOLE_DIST: 0.05    # 离空洞/旧点至少 5cm
    STRICT_CURV_TH: 0.07       # 表面必须非常平整
    
    # 宽松模式 (第二次尝试：允许次优点)
    RELAXED_NORM_TH: 0.87      # cos(30度)，允许斜坡
    RELAXED_HOLE_DIST: 0.035   # 离空洞至少 3.5cm (不能太近，否则崩塌)
    RELAXED_CURV_TH: 0.10      # 允许表面稍微粗糙
    
    # ==================== 评分权重 ====================
    HEIGHT_WEIGHT: 1.0         # 降低高度权重，平面情况下优先垂直角度
    CURV_WEIGHT: 2.0           # 优先打平整
    ANGLE_WEIGHT: 5.0          # 大幅提高角度权重，确保垂直度（平面优先）
    CENTER_WEIGHT: 5.0         # 优先打网格中心 (防止边缘效应)
     # ==================== 凸起处理策略参数 ====================
    PROTRUSION_TH: 0.02       # (米) Z轴极差超过2cm，则判定为存在凸起
    TIP_CROP_RATIO: 0.25      # 遇到凸起时，剔除顶部 25% 的高度 (避开滑动的顶点)
    BASE_CROP_RATIO: 0.10     # 剔除底部 10% 的高度 (避开太深的位置)

    # ==================== 手眼标定矩阵 ====================
    # 相机坐标系到工具坐标系的 4x4 齐次变换矩阵
    # 格式：按行优先存储
    # 单位：位置为米（m），旋转为方向余弦矩阵
    hand_eye_calibration:
      # 第一行：[R11, R12, R13, Tx]
      row1: [0.002136129093849748, 0.0131617748027531, 0.9999110983665177,-0.3592755296727744]
      # 第二行：[R21, R22, R23, Ty]
      row2: [0.9998109504292265, -0.01935263737141502,-0.001881177444387261, -0.03444265988510906]
      # 第三行：[R31, R32, R33, Tz]
      row3: [0.01932615725645348,0.9997260840404296, -0.01320062630660779, -0.2227647594718163]
      # 第四行：[0, 0, 0, 1]
      row4: [0.0, 0.0, 0.0, 1.0]

    # 标定元数据
    calibration_metadata:
      date: "2026-01-05"
      marker_id: 123
      marker_size: 0.10  # 米
      data_count: 15  # 采集的数据组数
    